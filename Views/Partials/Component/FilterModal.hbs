<div x-show="open" x-cloak x-transition.opacity class="fixed inset-0 bg-black/10 backdrop-blur-sm z-40"></div>

<div x-show="open" x-cloak x-transition.opacity class="fixed inset-0 z-50 flex items-center justify-center px-4">

    <div class="bg-white rounded-xl w-full max-w-md relative" @click.outside="open = false">
        <form @submit.prevent="submit" style="margin: 0 auto;" class="filter-panel mx-auto"
            :class="{ 'collapsed': collapsed }">

            {{!-- <fieldset class="fieldset repair">
                <legend>Təmir vəziyyəti</legend>
                <div class="toggle-group" data-name="repair">
                    <template x-for="opt in repairs" :key="opt.value">
                        <button type="button" @click="form.repair = opt.value" class="toggle"
                            :class="{ 'active': form.repair === opt.value }" x-text="opt.label"></button>
                    </template>
                </div>
            </fieldset> --}}

            {{!-- <div class="dropdown-select mt-2 filter-container flex-1" data-filter="roomCount">
                <div
                    class="flex items-center justify-between cursor-pointer border px-4 py-2 rounded-xl h-10 w-full bg-white text-orange-500 hover:text-gray-700">
                    <span data-role="display-value" data-filter="roomCount">Otaq sayı</span>
                    <i class="bi bi-chevron-down text-sm transition-transform duration-300"></i>
                </div>
                <div class="absolute w-[40%] mt-1 bg-white border border-orange-200 rounded-lg shadow-lg z-10 hidden">
                    <ul class="py-1">
                        <li class="px-4 py-2 cursor-pointer hover:bg-gray-100" data-value="">Otaq sayı</li>
                        <li class="px-4 py-2 cursor-pointer hover:bg-gray-100" data-value="1">1 otaqlı</li>
                        <li class="px-4 py-2 cursor-pointer hover:bg-gray-100" data-value="2">2 otaqlı</li>
                        <li class="px-4 py-2 cursor-pointer hover:bg-gray-100" data-value="3">3 otaqlı</li>
                        <li class="px-4 py-2 cursor-pointer hover:bg-gray-100" data-value="4">4 otaqlı</li>
                        <li class="px-4 py-2 cursor-pointer hover:bg-gray-100" data-value="5">5+ otaqlı</li>
                    </ul>
                </div>
            </div> --}}

            {{!-- <fieldset class="p-2 bg-white fieldset range-field rounded-lg border border-gray-200 relative">
                <div class="flex items-center gap-2">
                    <i class="bi bi-geo-alt text-orange-500 text-xl"></i>
                    <input type="text" placeholder="Enter address..." class="w-full rounded-lg focus:outline-none py-1"
                        id="addressInput" />
                </div>
                <div id="addressSuggestions"
                    class="absolute left-0 mt-2 w-full bg-white shadow-lg border border-gray-200 rounded-lg z-20 hidden">
                    <ul id="suggestionsList" class="divide-y divide-gray-100 max-h-60 overflow-y-auto">
                    </ul>
                </div>
            </fieldset> --}}

            {{!-- <fieldset class="fieldset range-field">
                <legend>Sahə, m²</legend>
                <div class="range">
                    <input type="number" placeholder="min." x-model.number="form.areaMin" min="0">
                    <span>—</span>
                    <input type="number" placeholder="maks." x-model.number="form.areaMax" min="0">
                </div>
            </fieldset> --}}

            {{!--
            <fieldset class="fieldset range-field">
                <legend>Mərtəbə</legend>
                <div class="range">
                    <input type="number" placeholder="min." x-model.number="form.floorMin" min="0">
                    <span>—</span>
                    <input type="number" placeholder="maks." x-model.number="form.floorMax" min="0">
                </div>
            </fieldset> --}}

            {{!--
            <fieldset class="fieldset location">
                <legend>Yerləşmə</legend>
                <div class="pill-group">
                    <template x-for="(label, id) in locationLabels" :key="id">
                        <div class="dropdown-wrapper" x-data="{ openDd: false }">
                            <button type="button" class="pill" @click="openDd = !openDd">
                                <span x-text="label"></span>
                                <i class="bi bi-chevron-down"></i>
                            </button>

                            <ul x-show="openDd" x-transition x-cloak class="dropdown">
                                <template x-for="item in dropdownData[id]" :key="item">
                                    <li class="dd-item" @click="addTag(id, item); openDd = false" x-text="item"></li>
                                </template>
                            </ul>
                        </div>
                    </template>
                </div>
            </fieldset> --}}

            {{!--
            <fieldset class="fieldset range-field">
                <legend>Qiymət, AZN</legend>
                <div class="range">
                    <input type="number" placeholder="min." x-model.number="form.priceMin" min="0">
                    <span>—</span>
                    <input type="number" placeholder="maks." x-model.number="form.priceMax" min="0">
                </div>
            </fieldset> --}}

            <fieldset class="fieldset extra w-full">
                <legend>Add №</legend>
                <input type="text" x-model="form.postId" placeholder="№" class="w-full">
                <label class="flex items-center gap-2">
                    <input type="checkbox" x-model="form.extraction"> Çıxarış var
                </label>
                <label class="flex items-center gap-2">
                    <input type="checkbox" x-model="form.mortgage"> İpoteka var
                </label>
                <div class="buttons mt-4 flex gap-2 justify-start">
                    <button type="submit" class="btn primary px-4 py-2">Axtar</button>
                    <button type="button" class="btn ghost" @click="open = false">Ləğv et</button>
                </div>
            </fieldset>

            {{!-- <div id="selectedTags" class="tags flex flex-wrap gap-2">
                <template x-for="(tag, i) in tags" :key="tag.scope + tag.value">
                    <span class="tag" :data-scope="tag.scope" :data-value="tag.value">
                        <span x-text="tag.value"></span>
                        <button type="button" aria-label="Sil" @click="removeTag(i)">&times;</button>
                    </span>
                </template>
            </div> --}}



        </form>
    </div>
</div>

<script>
    function filterModal() {
        return {
            open: false,
            collapsed: false,

            repairs: [
                { label: 'Hamısı', value: '' },
                { label: 'Təmirli', value: 'renovated' },
                { label: 'Təmirsiz', value: 'unrenovated' }
            ],
            dropdownData: {
                districts: ['Binəqədi', 'Nərimanov', 'Nəsimi', 'Xətai', 'Yasamal'],
                metros: ['28 May', 'Gənclik', 'Elmlər', 'İnşaatçılar'],
                landmarks: ['Gənclik Mall', 'Targovu', 'Flame Towers', 'Təhsil Nazirliyi']
            },
            locationLabels: {
                districts: 'Rayon və qəsəbələr',
                metros: 'Metrostansiyalar',
                landmarks: 'Nişangahlar'
            },
            tags: [],

            form: {
                repair: '',
                areaMin: '',
                areaMax: '',
                floorMin: '',
                floorMax: '',
                priceMin: '',
                priceMax: '',
                postId: '',
                extraction: false,
                mortgage: false
            },

            addTag(scope, value) {
                if (this.tags.find(t => t.scope === scope && t.value === value)) return;
                this.tags.push({ scope, value });
            },
            removeTag(idx) {
                this.tags.splice(idx, 1);
            },

            reset() {
                this.form = {
                    repair: '', areaMin: '', areaMax: '', floorMin: '', floorMax: '',
                    priceMin: '', priceMax: '', postId: '', extraction: false, mortgage: false
                };
                this.tags = [];
                this.collapsed = false;
            },

            submit() {
                const payload = { ...this.form, selected: this.tags };
                console.log(payload);
                this.open = false;
            }
        }
    }
</script>

<style>
    [x-cloak] {
        display: none !important;
    }
</style>