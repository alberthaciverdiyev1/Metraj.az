{{>Component.Breadcrumb items=breadcrumbs}}

{{>Component.ScrollTop}}

<section id="add-property">
    <div class=" container px-4 mx-auto">
        {{!-- <div class="left-side">
            <aside>
                <ul class="py-2 text-base text-gray-800 space-y-1">
                    <li>
                        <a href="#"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-grid mr-3 text-gray-400 group-hover:text-white transition"></i>
                            Dashboards
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-person-gear mr-3 text-gray-400 group-hover:text-white transition"></i>
                            My profile
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-bag-check mr-3 text-gray-400 group-hover:text-white transition"></i> My
                            package
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-heart mr-3 text-gray-400 group-hover:text-white transition"></i> My
                            favorites (1)
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-folder2-open mr-3 text-gray-400 group-hover:text-white transition"></i>
                            My save searches
                        </a>
                    </li>
                    <li>
                        <a href="#"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-chat-left-text mr-3 text-gray-400 group-hover:text-white transition"></i>
                            Reviews
                        </a>
                    </li>
                    <li>
                        <a href="/login"
                            class="flex rounded-lg items-center px-5 py-4 hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-folder-check mr-3 text-gray-400 group-hover:text-white transition"></i>
                            My properties
                        </a>
                    </li>
                    <li>
                        <a href="/add-property"
                            class="flex items-center px-5 py-4 bg-white rounded-lg hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-file-earmark-plus mr-3 text-gray-400 group-hover:text-white transition"></i>
                            Add property
                        </a>
                    </li>
                    <li>
                        <a href="/login"
                            class="flex items-center px-5 py-4 bg-white rounded-lg hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-person mr-3 text-gray-400 group-hover:text-white transition"></i> Login
                            / Register
                        </a>
                    </li>
                    <li>
                        <a href="/logout"
                            class="flex items-center px-5 py-4 bg-white rounded-lg hover:bg-orange-400 hover:text-white group transition">
                            <i class="bi bi-box-arrow-right mr-3 text-gray-400 group-hover:text-white transition"></i>
                            Logout
                        </a>
                    </li>
                </ul>


            </aside>
        </div> --}}

        <div class="w-full">
            <main>

                <div class="bg-white mt-2 p-5 mx-auto rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold mb-6">Additional Information</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

                        <!-- Property Type -->
                        <div>
                            <label class="block font-medium mb-1">{{t "Building Type"}}:<span
                                    class="text-red-500">*</span></label>
                            <select id="building-type"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option disabled selected>{{t "Choose"}}</option>
                            </select>
                        </div>
                        <!-- Add Type -->
                        <div>
                            <label class="block font-medium mb-1">{{t "Add type"}}:<span
                                    class="text-red-500">*</span></label>
                            <select id="add-type"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option disabled selected>{{t "Choose"}}</option>
                                <option value="sale">For Sale</option>
                                <option value="rent">For Rent</option>
                            </select>
                        </div>
                        <!-- Property Label -->
                        <div>
                            <label class="block font-medium mb-1">Təmir:<span class="text-red-500">*</span></label>
                            <select id="repair-type"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option selected disabled>{{t "Choose"}}</option>
                                <option value="repaired">{{t "Repaired"}}</option>
                                <option value="unrepaired">{{t "Unrepaired"}}</option>
                                <!-- options -->
                            </select>
                        </div>

                        <!-- Area -->
                        <div id="area">
                            <label class="block font-medium mb-1">{{t "Size"}} (m²):<span
                                    class="text-red-500">*</span></label>
                            <input type="number"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <!-- Field Area -->
                        <div id="field-area" class="d-none">
                            <label class="block font-medium mb-1">{{t "Field area"}} (m²):<span
                                    class="text-red-500">*</span></label>
                            <input type="number"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>

                        <!-- Price -->
                        <div>
                            <label class="block font-medium mb-1">{{t "Price"}}:<span
                                    class="text-red-500">*</span></label>
                            <input id="price" type="number" value="0"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />

                            <div class="d-none">
                                <select id="property-period"
                                    class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="daily"> Günlük</option>
                                    <option value="monthly">Aylıq</option>
                                </select>
                            </div>
                        </div>

                        <!-- Rooms -->
                        <div>
                            <label class="block font-medium mb-1">Room Count:<span class="text-red-500">*</span></label>
                            <select id="room-count"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option disabled selected>Choose</option>
                                {{#forLoop 20}}
                                <option value="{{this}}">{{this}} otaqlı</option>
                                {{/forLoop}}


                            </select>
                        </div>

                        <!-- Bedrooms -->
                        <div>
                            <label class="block font-medium mb-1">Mərtəbə:<span class="text-red-500">*</span></label>
                            <select id="located-floor"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option disabled selected>Choose</option>
                                {{#forLoop 100}}
                                <option value="{{this}}">{{this}}-ci mərtəbə</option>
                                {{/forLoop}}


                            </select>
                        </div>

                        <!-- Bathrooms -->
                        <div>
                            <label class="block font-medium mb-1">Mərtəbə sayı:<span
                                    class="text-red-500">*</span></label>
                            <select id="floor-count"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option disabled selected>Choose</option>

                                {{#forLoop 100}}
                                <option value="{{this}}">{{this}} mərtəbəli</option>

                                {{/forLoop}}
                            </select>
                        </div>

                        <!-- Garages -->
                        <div>
                            <label class="block font-medium mb-1">Kredit:<span class="text-red-500">*</span></label>
                            <input id="is-credit" type="checkbox"
                                class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>

                    </div>
                    <div class="bg-white rounded-xl w-full mx-auto mt-6">
                        <div class="mb-4">
                            <label for="description" class="block font-semibold mb-1">Description:</label>
                            <textarea name="description" id="description" placeholder="Your Description" rows="4"
                                class="w-full border border-gray-300 rounded-md px-4 py-2"></textarea>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl w-full mx-auto mt-6">
                        <div class="mb-4">
                            <label for="note-to-admin" class="block font-semibold mb-1">{{t "Note to admin"}}:</label>
                            <textarea name="note-to-admin" id="note-to-admin" placeholder="{{t " Note to admin"}}"
                                rows="4" class="w-full border border-gray-300 rounded-md px-4 py-2"></textarea>
                        </div>
                    </div>
                </div>

                <section id="upload-image">
                    <div class="px-6  mt-2 py-10 bg-white rounded-xl shadow-md  w-full    mx-auto">
                        <h2 class="text-3xl font-bold mb-4">Upload Media</h2>

                        <div id="dropzone"
                            class="border-2 border-dashed border-gray-300 rounded-lg py-14 flex flex-col items-center justify-center text-center min-h-[340px] transition">
                            <label
                                class="bg-[var(--primary)] text-white px-6 py-4 rounded-xl font-semibold hover:bg-orange-500 transition-all cursor-pointer mb-2">
                                <i class="bi bi-paperclip"></i> Select photos
                                <input id="fileInput" type="file" multiple accept="image/*" class="hidden">
                            </label>
                            <p class="text-sm text-gray-500">or drag photos here<br>(Up to 10 photos)</p>
                        </div>


                        <div id="gallery"
                            class="mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
                        <div class="my-4">
                            <label for="video" class="block font-semibold mb-1">Video:</label>
                            <input id="video" type="file" placeholder="Video"
                                class="w-full border border-gray-300 rounded-md px-4 py-2">
                        </div>

                        <div class="my-4">
                            <label for="document" class="block font-semibold mb-1">Document:</label>
                            <input id="document" type="file" placeholder="Document"
                                class="w-full border border-gray-300 rounded-md px-4 py-2">
                        </div>
                    </div>


                </section>

                <div class="p-8 w-full mx-auto rounded-lg shadow-md mt-3 font-sans bg-white text-gray-800">
                    <h2 class="text-xl font-semibold mb-4">{{t "Features"}} <span style="color: red">*</span></h2>

                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="features"></div>
                </div>

                <div class="p-8 w-full mx-auto rounded-lg shadow-md mt-3 font-sans bg-white text-gray-800">
                    <h2 class="text-xl font-semibold mb-4">{{t "Nearby objects"}} <span style="color: red">*</span></h2>

                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="nearby-objects"></div>
                </div>

                <section id="property-information">
                    <div class="p-6 bg-white rounded-xl shadow-md w-full mx-auto mt-6">
                        <h2 class="text-2xl font-bold mb-4">Information</h2>

                        <form method="POST" action="">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                <div>
                                    <label for="city" class="block font-semibold mb-1">Şəhər:*</label>
                                    <select id="city" class="w-full border border-gray-300 rounded-md px-4 py-2">
                                    </select>
                                </div>
                                <div class="d-none">
                                    <label for="district" class="block font-semibold mb-1">Rayon:*</label>
                                    <select id="district" class="w-full border border-gray-300 rounded-md px-4 py-2">
                                    </select>
                                </div>
                                <div class="d-none">
                                    <label for="town" class="block font-semibold mb-1">Qəsəbə:*</label>
                                    <select id="town" class="w-full border border-gray-300 rounded-md px-4 py-2">
                                    </select>
                                </div>
                                <div>
                                    <label for="subway" class="block font-semibold mb-1">Metro:*</label>
                                    <select id="subway" class="w-full border border-gray-300 rounded-md px-4 py-2">
                                    </select>
                                </div>
                            </div>
                            <div class="mb-4 gap-2 flex flex-col lg:flex-row justify-center items-center">
                                <div class="flex flex-col gap-4 w-full lg:w-[80%]">
                                    <label for="address" class="block font-semibold mb-1">Full Address:*</label>
                                    <input type="text" name="address" id="address"
                                        placeholder="Enter property full address"
                                        class="w-full border border-gray-300 rounded-md px-4 py-2">
                                </div>

                                <button type="button" id="searchAddress"
                                    class="w-full lg:w-[20%] mt-4 lg:mt-[44px] rounded-lg text-sm bg-[var(--primary)] text-white px-3 py-3 hover:bg-orange-600">
                                    Search on Map
                                </button>
                            </div>



                            <div class="mb-4">
                                <label class="block font-semibold mb-1">Location on Map:</label>
                                <div id="map" style="height: 400px; width: 100%;  border-radius: 0.375rem;"></div>
                                <input type="hidden" name="latitude" id="latitude">
                                <input type="hidden" name="longitude" id="longitude">
                            </div>

                            <div class="mb-4">
                                <label for="google_map_location" class="block font-semibold mb-1">Google Maps Link
                                    (optional):</label>
                                <input type="text" name="google_map_location" id="google_map_location"
                                    placeholder="https://maps.google.com/..."
                                    class="w-full border border-gray-300 rounded-md px-4 py-2">
                            </div>
                        </form>

                    </div>
                </section>

                {{>Component.AgentInfo}}
                <div class="flex items-start mt-6">
                    <input id="terms" type="checkbox"
                        class="mt-1 mr-2 w-4 h-4 text-[var(--primary)] border-gray-300 rounded focus:ring-0">
                    <label for="terms" class="select-none">
                        <a href="/istifadeci-razilasi" target="_blank"
                            class="text-blue-600 underline hover:text-blue-800 transition">
                            İstifadəçi razılaşmasını
                        </a> oxudum və qəbul edirəm
                        <span class="text-red-500">*</span>
                    </label>
                </div>

                <div class="flex justify-center items-center space-x-4 mt-6">
                    <button id="add-property-btn"
                        class=" sm:w-auto bg-[color:var(--primary)] text-white px-6 py-4 rounded-xl flex items-center justify-center button-hover all-btn hover:bg-orange-500 focus:outline-none">
                        Add Property
                    </button>
                </div>


            </main>
        </div>

    </div>
</section>

<script>
    console.log("testttt")
    const addBtn = document.getElementById('add-property-btn');
    const termsCheckbox = document.getElementById('terms');

    addBtn.disabled = !termsCheckbox.checked;
    addBtn.classList.toggle('opacity-50', !termsCheckbox.checked);
    addBtn.classList.toggle('cursor-not-allowed', !termsCheckbox.checked);

    termsCheckbox.addEventListener('change', e => {
        const accepted = e.target.checked;
        addBtn.disabled = !accepted;
        addBtn.classList.toggle('opacity-50', !accepted);
        addBtn.classList.toggle('cursor-not-allowed', !accepted);
    });
    addBtn.addEventListener('click', async e => {
        e.preventDefault();

        if (!termsCheckbox.checked) {
            alert('Elanı yerləşdirməzdən əvvəl istifadəçi razılaşmasını qəbul etməlisiniz.');
            return;
        }
        const fileInput = document.getElementById('fileInput');
        const videoInput = document.getElementById('video');
        const documentInput = document.getElementById('document');

        const formData = new FormData();
        console.log(document.getElementById('building-type').value);

        formData.append('buildingType', document.getElementById('building-type').value);
        formData.append('addType', document.getElementById('add-type').value);
        formData.append('propertyCondition', document.getElementById('repair-type').value);
        formData.append('price', document.getElementById('price').value);
        formData.append('propertyPeriod', document.getElementById('property-period').value);
        formData.append('roomCount', document.getElementById('room-count').value);
        formData.append('floorCount', document.getElementById('floor-count').value);
        formData.append('locatedFloor', document.getElementById('located-floor').value);
        formData.append('isCredit', document.getElementById('is-credit').checked ? 1 : 0);
        formData.append('description', document.getElementById('description').value);
        formData.append('noteToAdmin', document.getElementById('note-to-admin').value);
        formData.append('cityId', document.getElementById('city').value);
        formData.append('area', document.querySelector('#area input')?.value || null);
        formData.append('fieldArea', document.querySelector('#field-area input')?.value || null);
        formData.append('districtId', document.getElementById('district').value);
        formData.append('townId', document.getElementById('town').value);
        formData.append('subwayId', document.getElementById('subway').value);
        formData.append('address', document.getElementById('address').value);
        formData.append('map', document.getElementById('map').value);
        formData.append('advertiser', document.getElementById('advertiser')?.value || '');
        formData.append('advertiserName', document.getElementById('advertiser-name')?.value || '');
        formData.append('phone1', document.getElementById('phone_1').value);
        formData.append('phone2', document.getElementById('phone_2').value);
        formData.append('phone3', document.getElementById('phone_3').value);
        formData.append('phone4', document.getElementById('phone_4').value);
        formData.append('email', document.getElementById('email').value);

        Array.from(document.querySelectorAll('#features input[name="features[]"]:checked')).forEach((cb, i) => {
            formData.append(`features[${i}]`, cb.value);
        });

        Array.from(document.querySelectorAll('#nearby-objects input[name="nearby-objects[]"]:checked')).forEach((cb, i) => {
            formData.append(`nearbyObjects[${i}]`, cb.value);
        });

        images.forEach((file, index) => {
            formData.append(`media[${index}][type]`, 'image');
            formData.append(`media[${index}][file]`, file);
        });

        if (videoInput.files.length > 0) {
            const index = images.length;
            formData.append(`media[${index}][type]`, 'video');
            formData.append(`media[${index}][file]`, videoInput.files[0]);
        }

        if (documentInput.files.length > 0) {
            const index = images.length + (videoInput.files.length ? 1 : 0);
            formData.append(`media[${index}][type]`, 'document');
            formData.append(`media[${index}][file]`, documentInput.files[0]);
        }
        console.log({ formData });
        try {
            const response = await axios.post('/add-property', formData, {
                headers: {
                    'Content-Type': 'multipart/form-data'
                }
            });
            console.log(' Uğurla göndərildi:', response.data);
        } catch (error) {
            console.error('Error:', error.response?.data || error.message);
        }


    });
</script>

{{css 'components.css'}}
{{js 'gotop.js'}}
{{css 'add-property.css'}}
{{css 'app.css' }}
{{js 'app.js'}}
{{js 'map-find-adress.js'}}
{{js 'components/cities.js'}}
{{js 'components/features.js'}}
{{js 'components/propertyTypes.js'}}
{{js 'add-property.js'}}